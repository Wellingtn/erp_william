{% extends 'base.html' %}
{% load static %}

{% block title %}Catálogo de Produtos - Angels ERP{% endblock %}

{% block extra_css %}
<style>
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    .product-card {
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .product-card:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        transform: translateY(-5px);
    }
    #carrinho {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Catálogo de Produtos</h1>
    
    <div class="product-grid">
        {% for produto in produtos %}
        <div class="product-card bg-white">
            <img src="{% static 'images/placeholder.jpg' %}" alt="{{ produto.nome }}" class="w-full h-48 object-cover">
            <div class="p-4">
                <h2 class="text-xl font-semibold mb-2 text-gray-800">{{ produto.nome }}</h2>
                <p class="text-gray-600 mb-4">{{ produto.descricao|truncatewords:20 }}</p>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-purple-600">R$ {{ produto.preco }}</span>
                    <span class="text-sm text-gray-500">Estoque: {{ produto.quantidade }}</span>
                </div>
                <button onclick="adicionarAoCarrinho({{ produto.id }}, '{{ produto.nome }}', {{ produto.preco }})" class="mt-4 w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition duration-300">
                    Adicionar ao Carrinho
                </button>
            </div>
        </div>
        {% empty %}
        <p class="text-gray-600">Nenhum produto disponível no momento.</p>
        {% endfor %}
    </div>
</div>

<div id="carrinho" class="bg-white border border-gray-200 rounded-lg shadow-lg p-4 hidden">
    <h2 class="text-lg font-semibold mb-2">Carrinho de Compras</h2>
    <ul id="itens-carrinho" class="mb-4"></ul>
    <p class="font-bold">Total: R$ <span id="total-carrinho">0.00</span></p>
    <button onclick="finalizarCompra()" class="mt-4 w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 transition duration-300">
        Finalizar Compra
    </button>
</div>
{% endblock %}

{% block extra_js %}
<script>
let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

function adicionarAoCarrinho(produtoId, nome, preco) {
    const item = carrinho.find(i => i.id === produtoId);
    if (item) {
        item.quantidade += 1;
    } else {
        carrinho.push({id: produtoId, nome: nome, preco: preco, quantidade: 1});
    }
    localStorage.setItem('carrinho', JSON.stringify(carrinho));
    atualizarCarrinho();
}

function atualizarCarrinho() {
    const carrinhoElement = document.getElementById('carrinho');
    const itensCarrinho = document.getElementById('itens-carrinho');
    const totalCarrinho = document.getElementById('total-carrinho');
    
    itensCarrinho.innerHTML = '';
    let total = 0;

    carrinho.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.nome} - ${item.quantidade}x R$ ${item.preco}`;
        const removerBtn = document.createElement('button');
        removerBtn.textContent = 'Remover';
        removerBtn.className = 'ml-2 text-red-500 hover:text-red-700';
        removerBtn.onclick = () => removerDoCarrinho(item.id);
        li.appendChild(removerBtn);
        itensCarrinho.appendChild(li);
        total += item.preco * item.quantidade;
    });

    totalCarrinho.textContent = total.toFixed(2);
    carrinhoElement.classList.toggle('hidden', carrinho.length === 0);
}

function removerDoCarrinho(produtoId) {
    carrinho = carrinho.filter(item => item.id !== produtoId);
    localStorage.setItem('carrinho', JSON.stringify(carrinho));
    atualizarCarrinho();
}

function finalizarCompra() {
    if (carrinho.length === 0) {
        alert('Seu carrinho está vazio!');
        return;
    }

    window.location.href = '/vendas/iniciar/';
}

// Inicializar o carrinho ao carregar a página
document.addEventListener('DOMContentLoaded', atualizarCarrinho);
</script>
{% endblock %}

